---
title: API Reference
---

## `Queue`

```ts
function Queue<T>(
    path: string,
    worker: (job: T): Promise<void>
): QueueInstance<T>
```

Creates a new Queue.
Make sure to export it from an [API Route](https://nextjs.org/docs/api-routes/introduction), otherwise it won't work.

#### Parameters

| Parameter | Usage                                                                   |
| --------- | ----------------------------------------------------------------------- |
| `path`    | The queue's path. `queues/email` if reachable under `api/queues/email`. |
| `worker`  | a function that takes the job's payload and returns a `Promise`         |


### `.enqueue`

```ts
async enqueue(
    payload: T,
    options: {
        runAt?: Date;
        delay?: number;
        id?: string;
    }
): Promise<Job<T>>
```

Enqueues a new Job and returns it.

#### Options

| Option | Type                  | Behaviour                                                                                          |
| ------ | --------------------- | -------------------------------------------------------------------------------------------------- |
| runAt  | Date                  | If set, the job is scheduled for a specific Date in the future.                                    |
| delay  | number [milliseconds] | If set, the job will be delayed by the specified time. Use over `runAt` to prevent clock drift.    |
| id     | string                | If there's a pending job with the same ID, this job is a no-op. Use when idempotency is important. |

### `.get`

```ts
*get(): AsyncIterator< Job<T>[] >
```

A generator function that can be used to iterate over pending jobs:

```ts
for await (const jobs of queue.get()) {
    // do something
}
```


### `.getById`

```ts
getById(id: string): Promise<Job<T> | null>
```

Returns a job's representation, if it exists.

### `.invoke`

```ts
invoke(id: string): Promise<Job<T> | null>
```

Gets a job and invokes it, if it exists.
Returns the job's representation.

### `.delete`

```ts
delete(id: string): Promise<Job<T> | null>
```

Gets a job and deletes it, if it exists.
Returns the job's representation.

## `Job`

A representation of a pending job.
Can be retrieved using `Queue` methods.

### `id`

```ts
id: string
```

The job's `id`.
If not specified during `.enqueue`, it's a random UUID generated by Quirrel.

### `endpoint`

```ts
endpoint: string
```

The HTTP endpoint the job will be executed against.
Is always the same.

### `body`

```ts
body: T
```

The job's payload.

### `runAt`

```ts
runAt: Date
```

The date the job is scheduled for.

### `.invoke`

```ts
invoke(): Promise<Job | null>
```

Invokes the job and returns it.
Returns `null` if it's already been executed / deleted.

### `.delete`

```ts
delete(): Promise<Job | null>
```

Deletes the job and returns it.
Returns `null` if it's already been deleted / executed.
